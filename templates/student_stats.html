{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ</h2>

    <!-- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <h4 class="card-title mb-3">üìà –ó–∞–≥–∞–ª—å–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏</h4>
            <div class="row">
                <!-- –°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª -->
                <div class="col-md-4 mb-3">
                    <div class="p-3 rounded bg-light">
                        <h5>–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</h5>
                        <div class="display-4 {% if overall_avg >= 10 %}text-success{% else %}text-warning{% endif %}">
                            {{ overall_avg }}
                        </div>
                        <small class="text-muted">
                            {% if overall_avg >= 10 %}–í—ñ–¥–º—ñ–Ω–Ω–æ!{% else %}–ú–æ–∂–Ω–∞ –∫—Ä–∞—â–µ!{% endif %}
                        </small>
                    </div>
                </div>

                <!-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Ü—ñ–Ω–æ–∫ -->
                <div class="col-md-4 mb-3">
                    <div class="p-3 rounded bg-light">
                        <h5>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Ü—ñ–Ω–æ–∫</h5>
                        <div class="display-4">{{ grades|length }}</div>
                        <small class="text-muted">–ó–∞ –≤–µ—Å—å –ø–µ—Ä—ñ–æ–¥</small>
                    </div>
                </div>

                <!-- –í—ñ–¥—Å–æ—Ç–æ–∫ —É—Å–ø—ñ—à–Ω–∏—Ö –æ—Ü—ñ–Ω–æ–∫ -->
                <div class="col-md-4 mb-3">
                    <div class="p-3 rounded bg-light">
                        <h5>–£—Å–ø—ñ—à–Ω—ñ –æ—Ü—ñ–Ω–∫–∏</h5>
                        <div class="display-4">{{ success_percentage }}%</div>
                        <small class="text-muted">–û—Ü—ñ–Ω–∫–∏ —â–æ –≤–∏—â–µ 7</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–∏–Ω–∞–º—ñ–∫–∞ –æ—Ü—ñ–Ω–æ–∫ -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <h4 class="card-title mb-3">üìâ –î–∏–Ω–∞–º—ñ–∫–∞ –æ—Ü—ñ–Ω–æ–∫</h4>
            <canvas id="gradesChart"></canvas>
        </div>
    </div>

    <div class="card shadow mt-4">
        <div class="card-body">
            <h4 class="card-title mb-3">üìö –î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h4>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                            <th>–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</th>
                            <th>–û—Å—Ç–∞–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∞</th>
                            <th>–¢–µ–Ω–¥–µ–Ω—Ü—ñ—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for subject, data in subjects_stats.items() %}
                        <tr>
                            <td>{{ subject }}</td>
                            <td>
                                <span class="badge {% if data.average >= 10 %}bg-success{% else %}bg-warning{% endif %}">
                                    {{ data.average }}
                                </span>
                            </td>
                            <td>{{ data.last_grade }}</td>
                            <td>
                                {% if data.trend == 'up' %}
                                    <span class="text-success fs-5">‚Üë</span>
                                {% elif data.trend == 'down' %}
                                    <span class="text-danger fs-5">‚Üì</span>
                                {% elif data.trend == 'stable' %}
                                    <span class="text-secondary fs-5">‚Üí</span>
                                {% else %}
                                    <span class="text-muted fs-5">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // –î–∞–Ω—ñ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫–∞
    const labels = JSON.parse('{{ dates | tojson | safe }}');
    const dataPoints = JSON.parse('{{ grades_list | tojson | safe }}');

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫–∞
    const ctx = document.getElementById('gradesChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '–û—Ü—ñ–Ω–∫–∏',
                data: dataPoints,
                borderColor: '#4e73df',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 12
                }
            }
        }
    });
</script>
{% endblock %}